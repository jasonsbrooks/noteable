#!/usr/bin/env node
var chalk = require('chalk'),
    config = require('../config/config');

console.log('---------------------------');
var Cloudant = require('../config/cloudant').initialize(config);
Cloudant.testDbConnection(function(err, db) {

    console.log('---------------------------\n');

    var app = require('../app')(config, db);

    app.set('port', process.env.PORT || 3000);

    var server = app.listen(app.get('port'), function(err) {
        console.log(chalk.green('Express server listening on port ' + server.address().port));

        // launch webdav server
        var webdav = require('../webdav/webdav').listen(function() {
            console.log(chalk.green('Webdav server listening on port ' + webdav.address().port) + '\n');
        });

    }).on( 'error', function (e) {
        if (e.code == 'EADDRINUSE') {
            console.error(chalk.red('Could not start server: port in use'));
        } else {
            console.error(chalk.red(e.message));
        }
    });;

});
